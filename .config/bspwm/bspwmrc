#!/bin/bash
# by Miika Nissi, https://miikanissi.com, https://github.com/miikanissi

# make sure all processes are killed
killall -q picom # kill compositor
killall -q sxhkd # kill hotkeys

# wait until the processes have been shut down (just in case)
while pgrep -u $UID -x picom >/dev/null; do sleep 1; done
while pgrep -u $UID -x sxhkd >/dev/null; do sleep 1; done

### AUTOSTART ###
source ~/.bashrc
source ~/.xprofile
xrdb .Xresources & # refresh Xresources
sxhkd & # hotkeys
dunst --config ~/.config/dunst/dunstrc &
pgrep -x transmission-daemon >/dev/null || transmission-daemon &
pgrep -x mpd >/dev/null || mpd &
pgrep -x signal-desktop >/dev/null || signal-desktop --start-in-tray --use-tray-icon &
.local/bin/launch_desktops.sh & # polybar, xrandr and bspwm to setup desktop env
.local/bin/keyboard.sh # set keyboard conf
.local/bin/setbg.sh # sets wallpaper

if [[ -z $(which picom) ]]; then
  ~/.local/bin/picom/build/src/picom --config .config/picom/picom.conf --experimental-backends --vsync &
else
  picom --config .config/picom/picom.conf &
fi

### BSPC ###
bspc config pointer_modifier        mod4
bspc config border_width            2
bspc config window_gap              4
bspc config automatic_scheme        longest_side # longest_side, alternate or spiral

bspc config split_ratio             0.52
bspc config top_padding             32
bspc config borderless_monocle      true
bspc config gapless_monocle         true
bspc config single_monocle          true
bspc config focus_follows_pointer   true

bspc config focused_border_color    "#c85e7c"

bspc rule -a URxvt:ncmpcpp desktop='^5' state=floating follow=on
bspc rule -a Gimp desktop='^3' state=floating follow=on
bspc rule -a Emacs state=tiled
bspc rule -a Zathura state=tiled

xsetroot -cursor-name left_ptr &
